{"version":3,"file":"edit_icon_picker.min.js","sources":["../src/edit_icon_picker.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/* eslint space-before-function-paren: 0 */\n\n/**\n * Javascript Module to handle the icon picker dialogue for format_tiles\n * which the editing user uses to select an icon for a tile or the default icon\n * for all tiles in the course\n *\n * @module      format_tiles/icon_picker\n * @copyright   2018 David Watson {@link http://evolutioncode.uk}\n * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since       Moodle 3.3\n */\n\ndefine([\"jquery\", \"core/templates\", \"core/ajax\", \"core/str\", \"core/notification\", \"core/config\"],\n    function ($, Templates, ajax, str, Notification, config) {\n        \"use strict\";\n\n        var modalStored;\n        var stringStore = {pickAnIcon: ''};\n        var iconSet = [];\n        var recentPhotoSet = [];\n\n        /**\n         * Get the available icon set and photo set and store them for later use.\n         * @param {number}courseId\n         * @param {function|undefined} callback what to do after.\n         */\n        var getAndStoreIconSet = function(courseId, callback) {\n            var photosPromises = ajax.call([{\n                methodname: \"format_tiles_get_icon_set\",\n                args: {courseid: courseId}\n            }]);\n            photosPromises[0].done(function (response) {\n                if (response.photos) {\n                    recentPhotoSet = JSON.parse(response.photos);\n                }\n                var icons = JSON.parse(response.icons);\n                Object.keys(icons).forEach(function(icon) {\n                    iconSet.push({filename: icon, displayname: icons[icon]});\n                });\n                if (iconSet.length <= 0) {\n                    require([\"core/log\"], function(log) {\n                        log.error(\"Error empty icon set\");\n                        log.debug(response);\n                    });\n                }\n                if (typeof callback === \"function\") {\n                    callback();\n                }\n\n                // Check if there are any photos in the library that need deleting.\n                var photoNames = recentPhotoSet.map(function(photo) {\n                    return photo.filename;\n                });\n                $(\"#iconpickerphotos\").find(\".photo\").each(function (index, ph) {\n                    ph = $(ph);\n                    if (photoNames.indexOf(ph.data(\"filename\")) === -1) {\n                        ph.fadeOut(500);\n                    }\n                });\n                if (response.status !== true) {\n                    require([\"core/log\"], function(log) {\n                        log.error(\"Non true status response when getting icon set\");\n                        log.debug(response);\n                    });\n                }\n            });\n            photosPromises[0].fail(function (response) {\n                require([\"core/log\"], function(log) {\n                    log.error(\"Fail when getting icon set\");\n                    log.debug(response);\n                });\n            });\n        };\n\n        /**\n         * Get the URL for a link for a photo tile button (to access the edit form).\n         * @param {number} courseId\n         * @param {number} sectionId\n         * @param {number} cmid\n         * @returns {string}\n         */\n        var getPhotoTileButtonUrl = function(courseId, sectionId, cmid = 0) {\n            const url = config.wwwroot\n                + '/course/format/tiles/editor/editimage.php?courseid=' + courseId + '&sectionid=' + sectionId;\n            return cmid ? url + '&cmid=' + cmid.toString() : url;\n        };\n\n        /**\n         * Set the selected icon in the database via AJAX to the web service.\n         * When successful, then change the icon being displayed to the current editing user.\n         * If we are on an edit form, also select the selected icon in the hidden HTML selecftBox.\n         * The select box\n         * @param {number} sectionId\n         * @param {number} sectionNum\n         * @param {number} cmid\n         * @param {string} icon\n         * @param {string} displayname\n         * @param {string} pageType\n         * @param {number} courseId\n         * @param {string} imageType\n         * @param {number|undefined} sourcecontextid\n         * @param {number|undefined} sourceitemid\n         */\n        var setIcon = function (\n            sectionId, sectionNum, cmid, icon, displayname, pageType, courseId, imageType, sourcecontextid, sourceitemid\n        ) {\n            var selectedIcon = $(\"#selectedicon\");\n            var changeUiTilePhoto = function (jqueryObjToChange, imageUrl, imageType) {\n                var templateToRender = '';\n                var templateParams = {\n                    tileicon: icon,\n                    tileid: sectionNum,\n                    secid: sectionId,\n                    isediting: 1\n                };\n                switch (imageType) {\n                    case 'tileicon':\n                        templateToRender = 'tileicon';\n                        break;\n                    case 'tilephoto':\n                        if (!imageUrl) {\n                            // Unsetting photo.\n                            templateParams.tileicon = $('#format-tiles-js-config').data('defaultcourseicon');\n                            templateToRender = 'tileicon';\n                            break;\n                        }\n                        templateToRender = 'tilebarphoto';\n                        templateParams.phototileurl = imageUrl;\n                        templateParams.phototileediturl = getPhotoTileButtonUrl(courseId, sectionId);\n                        templateParams.iamgetype = imageType;\n                        jqueryObjToChange.closest(\".tileiconcontainer\").addClass(\"hasphoto\");\n                        // Refresh the photos in library as may not are still be available.\n                        setTimeout(function () {\n                            getAndStoreIconSet(courseId);\n                        }, 3000);\n                        break;\n                    case 'draftfile':\n                        templateToRender = 'tilebarphoto';\n                        templateParams.phototileurl = imageUrl;\n                        templateParams.phototileediturl = getPhotoTileButtonUrl(courseId, sectionId);\n                        templateParams.iamgetype = imageType;\n                        break;\n                    default:\n                        throw new Error(\"Invalid image type \" + imageType);\n                }\n                var divToAnimate = pageType === \"course-view-tiles\" ? jqueryObjToChange : selectedIcon;\n                divToAnimate.animate({opacity: 0}, 500, function () {\n                    Templates.render(\"format_tiles/\" + templateToRender, templateParams)\n                        .done(function (html) {\n                            divToAnimate.html(html)\n                                .animate({opacity: 1}, 500);\n                        });\n                });\n                if (pageType === \"course-editsection\" && imageType === \"tilephoto\") {\n                        $('input[name=tilephoto]').val(icon);\n                }\n            };\n            $(\".tooltip\").tooltip(\"hide\");\n            const extrasEnabled = $('#icon-picker-modal-body').data('extra') === 1;\n            var ajaxIconPickArgs = {\n                image: icon,\n                courseid: courseId,\n                sectionid: sectionId === undefined ? 0 : sectionId,\n                cmid: !extrasEnabled || cmid === undefined ? 0 : cmid,\n                imagetype: imageType,\n                sourcecontextid: sourcecontextid === undefined ? 0 : sourcecontextid,\n                sourceitemid: sourceitemid === undefined ? 0 : sourceitemid,\n                // Sectionid will be zero if relates to whole course not just one sec.\n            };\n            var setIconDbPromises = ajax.call([{\n                methodname: \"format_tiles_set_image\",\n                args: ajaxIconPickArgs\n            }]);\n\n            setIconDbPromises[0].done(function (response) {\n                if (response.status === true) {\n                    if (cmid !== undefined && extrasEnabled && parseInt(cmid) !== 0) {\n                        const mod = $(`#module-${cmid} .activityiconcontainer`);\n                        if (response.imageurl) {\n                            mod.css('background-image', `url(${response.imageurl})`).addClass('hasphoto');\n                            mod.find('img.activityicon').hide();\n                        } else if (response.iconurl) {\n                            mod.removeClass('hasphoto')\n                                .css('background-image', 'none');\n                            mod.find('img.activityicon')\n                                .attr('src', response.iconurl)\n                                .show();\n                        } else {\n                            mod\n                                .css('background-image', '')\n                                .removeClass('hasphoto')\n                                .find('.subtile-bg').css('display', 'none');\n                        }\n                    } else {\n                        if (pageType === \"course-view-tiles\") {\n                            // We are changing an icon for a specific section from within the course.\n                            // We are doing this by clicking an existing icon.\n                            changeUiTilePhoto($(\"#tileicon_\" + sectionNum), response.imageurl, imageType);\n                        } else if (pageType === \"course-edit\" || pageType === \"course-editsection\") {\n                            // We are changing the icon using a drop down menu not the icon picker modal.\n                            // Either for the whole course or for one section.\n                            // Select new icon in drop down.\n                            var selectBox = $(\"#id_defaulttileicon\"); // Valid if page type is course-edit.\n                            if (pageType === \"course-editsection\") {\n                                selectBox = $(\"#id_tileicon\");\n                            }\n                            selectBox.val(icon);\n                            // Then change the image shown next to it.\n                            if (imageType === \"tileicon\") {\n                                Templates.renderPix(\"tileicon/\" + icon, \"format_tiles\", displayname)\n                                    .done(function (newIcon) {\n                                        selectedIcon.html(newIcon);\n                                        if (pageType === \"course-editsection\") {\n                                            str.get_strings([\n                                                {key: \"tip\", component: \"format_tiles\"},\n                                                {key: \"tileselecttip\", component: \"format_tiles\"}\n                                            ]).done(function (strings) {\n                                                Notification.alert(\n                                                    strings[0],\n                                                    strings[1]\n                                                );\n                                            });\n                                        }\n                                    });\n                                if (pageType === \"course-editsection\") {\n                                    $('input[name=tilephoto]').val(\"\");\n                                }\n                            } else if (imageType === \"tilephoto\") {\n                                changeUiTilePhoto($(\"#tileicon_\" + sectionNum), response.imageurl, imageType);\n                            }\n                        }\n                    }\n                } else {\n                    require([\"core/log\"], function(log) {\n                        log.error(\"False response setting icon\");\n                        log.debug(response);\n                    });\n                }\n            }).fail(function(response) {\n                require([\"core/log\"], function(log) {\n                    log.error(\"Fail setting icon\");\n                    log.debug(response);\n                });\n            });\n        };\n\n        /**\n         * When user clicks to launch an icon picker modal, set which section it relates to\n         * so that we know which section the icon clicked is for.  This is so that only one modal needs\n         * to be rendered (with all the icons in it) - we can use it to assign icons to any section\n         * @param {string} pageType\n         * @param {number} courseId\n         * @param {int} sectionId\n         * @param {int} section\n         * @param {int} cmid\n         * @param {int} allowPhotoTiles whether to render a button for the photo tile form - true or false).\n         * @param {string} documentationurl\n         */\n        var launchIconPicker = function (pageType, courseId, sectionId, section, cmid, allowPhotoTiles, documentationurl) {\n            // Launch icon picker can be a tile icon (if editing course) or a button (if on a form).\n            var populatePhotoLibrary = function(photosHTML, modalRoot, modal) {\n                var photoLibrary = $(\"#iconpickerphotos\");\n                photoLibrary.html(photosHTML);\n\n                // Load the images that are not too large immediately.\n                // (User draft files may be large so leave them to load last.\n                var largeFileThreshold = 200000; // Bytes.\n                var doLast = [];\n                photoLibrary.find(\".photo\").each(function (index, image) {\n                    image = $(image);\n                    if (image.data(\"filesize\") < largeFileThreshold && image.data(\"url\")) {\n                        setTimeout(function () {\n                            image.attr(\"style\", `background-image: url('${image.data(\"url\")}');`);\n                        }, index * 20);\n                    } else {\n                        doLast.push(image);\n                    }\n\n                    image.click(function (e) {\n                        var clickedImage = $(e.currentTarget);\n                        setIcon(\n                            !modalRoot.data('cmid') ? modalRoot.data(\"true-sectionid\") : 0,\n                            !modalRoot.data('cmid') ? modalRoot.data(\"section\") : 0,\n                            modalRoot.data('cmid') ?? 0,\n                            clickedImage.data(\"filename\"),\n                            clickedImage.data(\"filename\"),\n                            pageType,\n                            courseId,\n                            clickedImage.data(\"imagetype\"),\n                            clickedImage.data(\"contextid\"), // For existing photos - sourcecontextid.\n                            clickedImage.data(\"itemid\") // For existing photos - sourceitemid.\n                        );\n                        modal.hide();\n                    });\n                });\n                setTimeout(function () {\n                    doLast.forEach(function (image) {\n                        image.attr(\"src\", image.data(\"url\"));\n                    });\n                }, 1000);\n            };\n\n            const hideShowTabs = function (modalRoot) {\n                if (cmid !== undefined) {\n                    // In this case we are setting a cm photo, so only show photo divs not icons.\n                    modalRoot.find(\"#launch-photo-library\").click();\n                }\n            };\n\n            if (typeof modalStored !== \"object\") {\n                // We only have one modal per page which we recycle.  We dont have it yet so create it.\n\n                var renderModal = function() {\n                    Templates.render(\"format_tiles/icon_picker_modal_body\", {\n                        /* eslint-disable-next-line camelcase */\n                        icon_picker_icons: iconSet,\n                        showphotos: allowPhotoTiles,\n                        showicons: true, // Always include this but we can hide it when using photos.\n                        wwwroot: config.wwwroot,\n                        documentationurl: documentationurl\n                    }).done(function (iconsHTML) {\n                        require([\"core/modal_factory\"], function (modalFact) {\n                            modalFact.create({\n                                type: modalFact.types.DEFAULT,\n                                title: stringStore.pickAnIcon,\n                                body: iconsHTML\n                            }).done(function (modal) {\n                                modalStored = modal;\n                                modal.setLarge();\n                                modal.show();\n                                var modalRoot = $(modal.root);\n                                modalRoot.attr(\"id\", \"icon_picker_modal\");\n                                modalRoot.data(\"true-sectionid\", sectionId);\n                                modalRoot.data(\"section\", section);\n                                modalRoot.data(\"cmid\", cmid);\n                                modalRoot.addClass(\"icon_picker_modal\");\n                                modalRoot.on(\"click\", \".pickericon\", function (e) {\n                                    var newIcon = $(e.currentTarget);\n                                    setIcon(\n                                        sectionId,\n                                        section,\n                                        cmid,\n                                        newIcon.data(\"icon\"),\n                                        newIcon.attr(\"title\"),\n                                        pageType,\n                                        courseId,\n                                        'tileicon',\n                                        newIcon.data(\"contextid\"), // For existing photos - sourcecontextid.\n                                        newIcon.data(\"itemid\") // For existing photos - sourcetemid.\n                                    );\n                                    modal.hide();\n                                });\n                                // Icon search box handling.\n                                modalRoot.on(\"input\", \"input.iconsearch\", function (e) {\n                                    var searchText = e.currentTarget.value.toLowerCase();\n                                    modalRoot.find(\".pickericon\").show();\n                                    if (searchText.length >= 3) {\n                                        modalRoot.find(\".pickericon\").filter(function (index, icon) {\n                                            // Show all icons then hide icons which do not match the search term.\n                                            return $(icon).data('original-title').toLowerCase().indexOf(searchText) < 0;\n                                        }).hide();\n                                    }\n                                });\n                                try {\n                                    const pickerIcon = $(\".pickericon\");\n                                    if (typeof pickerIcon.tooltip == 'function') {\n                                        pickerIcon.tooltip();\n                                    }\n                                } catch (err) {\n                                    require([\"core/log\"], function (log) {\n                                        log.debug(err);\n                                    });\n                                }\n                                if (allowPhotoTiles) {\n                                    // Set the URL for the photo tile button if used (done dynamically as contains section id).\n                                    var url = getPhotoTileButtonUrl(courseId, sectionId, cmid);\n                                    modalRoot.find('#phototilebtn')\n                                        .attr('href', url);\n                                    // Now that we have modal, if photo library tab is clicked we need to lazy load the photos.\n                                    $(\"#launch-photo-library\").click(function () {\n                                        if (recentPhotoSet.length !== 0) {\n                                            Templates.render(\"format_tiles/icon_picker_photos\", {\n                                                /* eslint-disable-next-line camelcase */\n                                                icon_picker_photos: recentPhotoSet,\n                                                wwwroot: config.wwwroot\n                                            }).done(function (photosHTML) {\n                                                populatePhotoLibrary(photosHTML, modalRoot, modal);\n                                            });\n                                        }\n                                    });\n                                }\n                                hideShowTabs(modalRoot);\n                                $(document).trigger('format-tiles-icon-picker-modal-created');\n                            });\n                        });\n                    });\n                };\n                if (iconSet.length <= 0) {\n                    getAndStoreIconSet(courseId, renderModal);\n                } else {\n                    renderModal();\n                }\n            } else {\n                // We already have the modal so recycle it instead of re-rendering.\n                modalStored.root.data(\"true-sectionid\", sectionId);\n                modalStored.root.data(\"section\", section);\n                modalStored.root.data(\"cmid\", cmid === undefined ? 0 : cmid);\n                modalStored.root.off(\"click\");\n                modalStored.root.on(\"click\", \".pickericon\", function (e) {\n                    var newIcon = $(e.currentTarget);\n                    setIcon(\n                        sectionId,\n                        section,\n                        cmid,\n                        newIcon.data(\"icon\"),\n                        newIcon.attr(\"title\"),\n                        pageType,\n                        courseId,\n                        newIcon.data(\"imagetype\"),\n                        newIcon.data(\"contextid\"), // For existing photos - sourcecontextid.\n                        newIcon.data(\"itemid\") // For existing photos - sourcetemid.\n                    );\n                    modalStored.hide();\n                });\n                if (allowPhotoTiles) {\n                    // Set the URL for the photo tile button if used (done dynamically as contains section id).\n                    var url = getPhotoTileButtonUrl(courseId, sectionId, cmid);\n                    modalStored.root.find('#phototilebtn')\n                        .attr('href', url);\n                }\n                hideShowTabs(modalStored.root);\n                modalStored.show();\n            }\n        };\n\n        return {\n            init: function (courseId, pageType, allowPhotoTiles, documentationurl) {\n                $(document).ready(function () {\n                    var stringKey = allowPhotoTiles ? \"picknewiconphoto\" : \"picknewicon\";\n                    str.get_string(stringKey, \"format_tiles\").done(function (pickAnIcon) {\n                        stringStore.pickAnIcon = pickAnIcon;\n                    });\n                    // Get the core icon set now so that we don't have to wait later.\n                    getAndStoreIconSet(courseId);\n\n                    var pageContent = $(\"#page-content\");\n                    if (pageContent.length === 0) {\n                        // Some themes e.g. RemUI do not have a #page-content div, so use #region-main.\n                        pageContent = $(\"#region-main\");\n                    }\n                    pageContent.on(\"click\", '[data-tiles-action=\"launch-tiles-icon-picker\"]', function (e) {\n                        e.preventDefault();\n                        var clickedIcon = $(e.currentTarget);\n                        launchIconPicker(\n                            pageType,\n                            courseId,\n                            clickedIcon.data('true-sectionid'),\n                            clickedIcon.data('section'),\n                            clickedIcon.data('cmid'),\n                            allowPhotoTiles,\n                            documentationurl\n                        );\n                    });\n                });\n            }\n        };\n    }\n);"],"names":["define","$","Templates","ajax","str","Notification","config","modalStored","stringStore","pickAnIcon","iconSet","recentPhotoSet","getAndStoreIconSet","courseId","callback","photosPromises","call","methodname","args","courseid","done","response","photos","JSON","parse","icons","Object","keys","forEach","icon","push","filename","displayname","length","require","log","error","debug","photoNames","map","photo","find","each","index","ph","indexOf","data","fadeOut","status","fail","getPhotoTileButtonUrl","sectionId","cmid","url","wwwroot","toString","setIcon","sectionNum","pageType","imageType","sourcecontextid","sourceitemid","selectedIcon","changeUiTilePhoto","jqueryObjToChange","imageUrl","templateToRender","templateParams","tileicon","tileid","secid","isediting","phototileurl","phototileediturl","iamgetype","closest","addClass","setTimeout","Error","divToAnimate","animate","opacity","render","html","val","tooltip","extrasEnabled","ajaxIconPickArgs","image","sectionid","undefined","imagetype","parseInt","mod","imageurl","css","hide","iconurl","removeClass","attr","show","selectBox","renderPix","newIcon","get_strings","key","component","strings","alert","launchIconPicker","section","allowPhotoTiles","documentationurl","hideShowTabs","modalRoot","click","renderModal","icon_picker_icons","showphotos","showicons","iconsHTML","modalFact","create","type","types","DEFAULT","title","body","modal","setLarge","root","on","e","currentTarget","searchText","value","toLowerCase","filter","pickerIcon","err","icon_picker_photos","photosHTML","photoLibrary","doLast","clickedImage","populatePhotoLibrary","document","trigger","off","init","ready","stringKey","get_string","pageContent","preventDefault","clickedIcon"],"mappings":"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"}