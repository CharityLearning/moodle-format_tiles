define(["jquery","core/templates","core/ajax","core/str","core/notification"],function(a,b,c,d,e){"use strict";return{init:function(f,g,h){var i,j=function(h,i,j,k){var l={icon:j,courseid:f,sectionid:h},m=c.call([{methodname:"format_tiles_set_icon",args:l}]);m[0].done(function(c){if(c===!0)if("course-view-tiles"===g){var f=a("#tileicon_"+i).find(".icon");f.animate({opacity:0},500,function(){b.render("format_tiles/tileicon",{tileicon:j,tileid:i,secid:h}).done(function(b){f.fadeOut(0).replaceWith(a(b).find(".icon")).animate({opacity:1},500)})})}else"course-edit"!==g&&"course-editsection"!==g||(k.val(j),b.renderPix("tileicon/"+j,"format_tiles").done(function(b){a("#selectedicon").html(b),"course-editsection"===g&&d.get_strings([{key:"tip",component:"format_tiles"},{key:"tileselecttip",component:"format_tiles"}]).done(function(a){e.alert(a[0],a[1])})}))}).fail(e.exception)},k=function(){a(".launchiconpicker").click(function(b){var c=a(b.currentTarget);require(["core/modal_factory"],function(b){d.get_string("pickicon","format_tiles").done(function(d){b.create({type:b.types.DEFAULT,title:d,body:a("#iconpickermodalbody").html()}).done(function(b){b.setLarge(),b.show();var d=a(b.root);d.attr("id","icon_picker_modal_"+c.attr("data-section")),d.attr("data-sectionid",c.attr("data-section")),d.addClass("icon_picker_modal"),d.on("click",".pickericon",function(d){j(c.attr("data-sectionid"),c.attr("data-section"),a(d.currentTarget).attr("data-icon"),i),b.hide()})})})})})};a(document).ready(function(){"course-edit"===g?i=a("#id_defaulttileicon"):"course-editsection"===g&&(i=a("#id_tileicon")),"course-edit"===g||"course-editsection"===g?b.render("format_tiles/icon_picker_launch_btn",{initialicon:i.val(),sectionId:h}).done(function(b){a(b).insertAfter(i),k()}):k()})}}});