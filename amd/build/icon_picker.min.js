define(["jquery","core/templates","core/ajax","core/str","core/notification"],function(a,b,c,d,e){"use strict";return{init:function(f,g,h,i,j){var k,l=function(h,i,j,k,l){var m={icon:j,courseid:f,sectionid:h},n=c.call([{methodname:"format_tiles_set_icon",args:m}]);n[0].done(function(c){if(c===!0)if("course-view-tiles"===g){var f=a("#tileicon_"+i).find(".icon");f.animate({opacity:0},500,function(){b.render("format_tiles/tileicon",{tileicon:j,tileid:i,secid:h}).done(function(b){f.fadeOut(0).replaceWith(a(b).find(".icon")).animate({opacity:1},500)})})}else"course-edit"!==g&&"course-editsection"!==g||(l.val(j),b.renderPix("tileicon/"+j,"format_tiles",k).done(function(b){a("#selectedicon").html(b),"course-editsection"===g&&d.get_strings([{key:"tip",component:"format_tiles"},{key:"tileselecttip",component:"format_tiles"}]).done(function(a){e.alert(a[0],a[1])})}))}).fail(e.exception)},m=function(){a(".launchiconpicker").click(function(b){var c=a(b.currentTarget);require(["core/modal_factory"],function(b){d.get_string("pickicon","format_tiles").done(function(d){b.create({type:b.types.DEFAULT,title:d,body:a("#iconpickermodalbody").html()}).done(function(b){b.setLarge(),b.show();var d=a(b.root);d.attr("id","icon_picker_modal_"+c.attr("data-section")),d.attr("data-sectionid",c.attr("data-section")),d.addClass("icon_picker_modal"),d.on("click",".pickericon",function(d){var e=a(d.currentTarget);l(c.attr("data-sectionid"),c.attr("data-section"),e.attr("data-icon"),e.attr("title"),k),b.hide()}),d.on("input","input.icon-search",function(b){var c=b.currentTarget.value.toLowerCase();d.find(".pickericon").show(),c.length>=3&&d.find(".pickericon").filter(function(b,d){return a(d).attr("title").toLowerCase().indexOf(c)<0}).hide()})})})})})};a(document).ready(function(){var c;if("course-edit"===g?(k=a("#id_defaulttileicon"),c=a("#id_defaulttileicon option:selected").text()):"course-editsection"===g&&(k=a("#id_tileicon"),c=a("#id_tileicon option:selected").text()),"course-edit"===g||"course-editsection"===g&&"0"!==j){var d;switch(k.val()){case"":d=i;break;default:d=k.val()}b.render("format_tiles/icon_picker_launch_btn",{initialicon:d,initialname:c,sectionId:h}).done(function(b){a(b).insertAfter(k),k.hide(),m()})}else"course-editsection"===g&&"0"===j?k.closest(".row").hide():m()})}}});